lzc-sdk-version: 0.1
name: rustfs
package: cloud.lazycat.app.sebastiaan.rustfs
version: 1.0.0
application:
  routes:
    - /=http://rustfs:9001
  subdomain: rustfs
  background_task: true
  public_path:
    - /api/public
  ingress:
    # S3 API
    - protocol: tcp
      port: 9000
      service: rustfs
  health_check:
      disable: true
services:
  rustfs:
    restart: unless-stopped
    image: rustfs/rustfs:latest
    binds:
      - /lzcapp/var/data:/data
      - /lzcapp/var/app/logs:/app/logs
    environment:
      - RUSTFS_CONSOLE_ENABLE=true
      # - RUSTFS_SERVER_DOMAINS=${LAZYCAT_APP_DOMAIN}
      - RUSTFS_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_CONSOLE_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_ADDRESS=0.0.0.0:9000
      - RUSTFS_CONSOLE_ADDRESS=0.0.0.0:9001
  volume-permission-helper:
    image: alpine
    binds:
      - /lzcapp/var/data:/data
      - /lzcapp/var/app/logs:/app/logs
    command: >
      sh -c "
        chown -R 10001:10001 /data /app/logs &&
        echo 'Volume Permissions fixed' &&
        exit 0
      "
    restart: "no"
    health_check:
      disable: true
